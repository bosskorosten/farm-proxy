{
  "version": 3,
  "sources": ["../../../../.yarn/cache/real-require-npm-0.2.0-7f69dbc7b6-ddf44ee763.zip/node_modules/real-require/src/index.js", "../../../../.yarn/cache/thread-stream-npm-2.7.0-b184293d78-03e743a2cc.zip/node_modules/thread-stream/lib/indexes.js", "../../../../.yarn/cache/thread-stream-npm-2.7.0-b184293d78-03e743a2cc.zip/node_modules/thread-stream/lib/wait.js", "../../../../.yarn/cache/thread-stream-npm-2.7.0-b184293d78-03e743a2cc.zip/node_modules/thread-stream/lib/worker.js"],
  "sourcesContent": ["/* eslint-disable no-new-func, camelcase */\n/* globals __non_webpack__require__ */\n\nconst realImport = new Function('modulePath', 'return import(modulePath)')\n\nfunction realRequire(modulePath) {\n  if (typeof __non_webpack__require__ === 'function') {\n    return __non_webpack__require__(modulePath)\n  }\n\n  return require(modulePath)\n}\n\nmodule.exports = { realImport, realRequire }\n", "'use strict'\n\nconst WRITE_INDEX = 4\nconst READ_INDEX = 8\n\nmodule.exports = {\n  WRITE_INDEX,\n  READ_INDEX\n}\n", "'use strict'\n\nconst MAX_TIMEOUT = 1000\n\nfunction wait (state, index, expected, timeout, done) {\n  const max = Date.now() + timeout\n  let current = Atomics.load(state, index)\n  if (current === expected) {\n    done(null, 'ok')\n    return\n  }\n  let prior = current\n  const check = (backoff) => {\n    if (Date.now() > max) {\n      done(null, 'timed-out')\n    } else {\n      setTimeout(() => {\n        prior = current\n        current = Atomics.load(state, index)\n        if (current === prior) {\n          check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2)\n        } else {\n          if (current === expected) done(null, 'ok')\n          else done(null, 'not-equal')\n        }\n      }, backoff)\n    }\n  }\n  check(1)\n}\n\n// let waitDiffCount = 0\nfunction waitDiff (state, index, expected, timeout, done) {\n  // const id = waitDiffCount++\n  // process._rawDebug(`>>> waitDiff ${id}`)\n  const max = Date.now() + timeout\n  let current = Atomics.load(state, index)\n  if (current !== expected) {\n    done(null, 'ok')\n    return\n  }\n  const check = (backoff) => {\n    // process._rawDebug(`${id} ${index} current ${current} expected ${expected}`)\n    // process._rawDebug('' + backoff)\n    if (Date.now() > max) {\n      done(null, 'timed-out')\n    } else {\n      setTimeout(() => {\n        current = Atomics.load(state, index)\n        if (current !== expected) {\n          done(null, 'ok')\n        } else {\n          check(backoff >= MAX_TIMEOUT ? MAX_TIMEOUT : backoff * 2)\n        }\n      }, backoff)\n    }\n  }\n  check(1)\n}\n\nmodule.exports = { wait, waitDiff }\n", "'use strict'\n\nconst { realImport, realRequire } = require('real-require')\nconst { workerData, parentPort } = require('worker_threads')\nconst { WRITE_INDEX, READ_INDEX } = require('./indexes')\nconst { waitDiff } = require('./wait')\n\nconst {\n  dataBuf,\n  filename,\n  stateBuf\n} = workerData\n\nlet destination\n\nconst state = new Int32Array(stateBuf)\nconst data = Buffer.from(dataBuf)\n\nasync function start () {\n  let worker\n  try {\n    if (filename.endsWith('.ts') || filename.endsWith('.cts')) {\n      // TODO: add support for the TSM modules loader ( https://github.com/lukeed/tsm ).\n      if (!process[Symbol.for('ts-node.register.instance')]) {\n        realRequire('ts-node/register')\n      } else if (process.env.TS_NODE_DEV) {\n        realRequire('ts-node-dev')\n      }\n      // TODO: Support ES imports once tsc, tap & ts-node provide better compatibility guarantees.\n      // Remove extra forwardslash on Windows\n      worker = realRequire(decodeURIComponent(filename.replace(process.platform === 'win32' ? 'file:///' : 'file://', '')))\n    } else {\n      worker = (await realImport(filename))\n    }\n  } catch (error) {\n    // A yarn user that tries to start a ThreadStream for an external module\n    // provides a filename pointing to a zip file.\n    // eg. require.resolve('pino-elasticsearch') // returns /foo/pino-elasticsearch-npm-6.1.0-0c03079478-6915435172.zip/bar.js\n    // The `import` will fail to try to load it.\n    // This catch block executes the `require` fallback to load the module correctly.\n    // In fact, yarn modifies the `require` function to manage the zipped path.\n    // More details at https://github.com/pinojs/pino/pull/1113\n    // The error codes may change based on the node.js version (ENOTDIR > 12, ERR_MODULE_NOT_FOUND <= 12 )\n    if ((error.code === 'ENOTDIR' || error.code === 'ERR_MODULE_NOT_FOUND') &&\n     filename.startsWith('file://')) {\n      worker = realRequire(decodeURIComponent(filename.replace('file://', '')))\n    } else if (error.code === undefined || error.code === 'ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING') {\n      // When bundled with pkg, an undefined error is thrown when called with realImport\n      // When bundled with pkg and using node v20, an ERR_VM_DYNAMIC_IMPORT_CALLBACK_MISSING error is thrown when called with realImport\n      // More info at: https://github.com/pinojs/thread-stream/issues/143\n      worker = realRequire(decodeURIComponent(filename.replace(process.platform === 'win32' ? 'file:///' : 'file://', '')))\n    } else {\n      throw error\n    }\n  }\n\n  // Depending on how the default export is performed, and on how the code is\n  // transpiled, we may find cases of two nested \"default\" objects.\n  // See https://github.com/pinojs/pino/issues/1243#issuecomment-982774762\n  if (typeof worker === 'object') worker = worker.default\n  if (typeof worker === 'object') worker = worker.default\n\n  destination = await worker(workerData.workerData)\n\n  destination.on('error', function (err) {\n    Atomics.store(state, WRITE_INDEX, -2)\n    Atomics.notify(state, WRITE_INDEX)\n\n    Atomics.store(state, READ_INDEX, -2)\n    Atomics.notify(state, READ_INDEX)\n\n    parentPort.postMessage({\n      code: 'ERROR',\n      err\n    })\n  })\n\n  destination.on('close', function () {\n    // process._rawDebug('worker close emitted')\n    const end = Atomics.load(state, WRITE_INDEX)\n    Atomics.store(state, READ_INDEX, end)\n    Atomics.notify(state, READ_INDEX)\n    setImmediate(() => {\n      process.exit(0)\n    })\n  })\n}\n\n// No .catch() handler,\n// in case there is an error it goes\n// to unhandledRejection\nstart().then(function () {\n  parentPort.postMessage({\n    code: 'READY'\n  })\n\n  process.nextTick(run)\n})\n\nfunction run () {\n  const current = Atomics.load(state, READ_INDEX)\n  const end = Atomics.load(state, WRITE_INDEX)\n\n  // process._rawDebug(`pre state ${current} ${end}`)\n\n  if (end === current) {\n    if (end === data.length) {\n      waitDiff(state, READ_INDEX, end, Infinity, run)\n    } else {\n      waitDiff(state, WRITE_INDEX, end, Infinity, run)\n    }\n    return\n  }\n\n  // process._rawDebug(`post state ${current} ${end}`)\n\n  if (end === -1) {\n    // process._rawDebug('end')\n    destination.end()\n    return\n  }\n\n  const toWrite = data.toString('utf8', current, end)\n  // process._rawDebug('worker writing: ' + toWrite)\n\n  const res = destination.write(toWrite)\n\n  if (res) {\n    Atomics.store(state, READ_INDEX, end)\n    Atomics.notify(state, READ_INDEX)\n    setImmediate(run)\n  } else {\n    destination.once('drain', function () {\n      Atomics.store(state, READ_INDEX, end)\n      Atomics.notify(state, READ_INDEX)\n      run()\n    })\n  }\n}\n\nprocess.on('unhandledRejection', function (err) {\n  parentPort.postMessage({\n    code: 'ERROR',\n    err\n  })\n  process.exit(1)\n})\n\nprocess.on('uncaughtException', function (err) {\n  parentPort.postMessage({\n    code: 'ERROR',\n    err\n  })\n  process.exit(1)\n})\n\nprocess.once('exit', exitCode => {\n  if (exitCode !== 0) {\n    process.exit(exitCode)\n    return\n  }\n\n  if (destination?.writableNeedDrain && !destination?.writableEnded) {\n    parentPort.postMessage({\n      code: 'WARNING',\n      err: new Error('ThreadStream: process exited before destination stream was drained. this may indicate that the destination stream try to write to a another missing stream')\n    })\n  }\n\n  process.exit(0)\n})\n"],
  "mappings": "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",
  "names": ["exports", "module", "realImport", "realRequire", "exports", "module", "exports", "module", "state", "waitDiff"]
}
